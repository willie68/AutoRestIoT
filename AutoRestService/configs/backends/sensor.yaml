backendname: sensors
description: sensor model f√ºr storing and retrieving sensor data
models:
  - name: temperatur
    fields:
      - name: temperatur
        type: float
        mandatory: false
        collection: false
      - name: vstring
        type: string
        mandatory: false
        collection: false
      - name: vint
        type: int
        mandatory: false
        collection: false
      - name: vfloat
        type: float
        mandatory: false
        collection: false
      - name: vtime
        type: time
        mandatory: false
        collection: false
      - name: vbool
        type: bool
        mandatory: false
        collection: false
      - name: source
        type: string
        mandatory: false
        collection: false
datasources:
  - name: temp_kueche
    type: mqtt
    destinations: 
      - $model.temperatur 
      - mqtt_sensors_temperatur
    rule: tasmota_ds18b20
    config: 
      broker: 192.168.178.12:1883
      topic: tele/tasmota_63E6F8/SENSOR
      payload: application/json
      username: temp
      password: temp
      addTopicAsAttribute: topic
  - name: temp_simple_text
    type: mqtt
    destinations: 
      - $model.temperatur 
    config: 
      broker: 192.168.178.12:1883
      topic: stat/temperatur/simple/string
      payload: application/x.simple
      username: temp
      password: temp
      addTopicAsAttribute: topic
      simpleValueAttribute: vstring
      simpleValueAttributeType: string
  - name: temp_simple_int
    type: mqtt
    destinations: 
      - $model.temperatur 
    config: 
      broker: 192.168.178.12:1883
      topic: stat/temperatur/simple/int
      payload: application/x.simple
      username: temp
      password: temp
      addTopicAsAttribute: topic
      simpleValueAttribute: vint
      simpleValueAttributeType: int
  - name: temp_simple_float
    type: mqtt
    destinations: 
      - $model.temperatur 
    config: 
      broker: 192.168.178.12:1883
      topic: stat/temperatur/simple/float
      payload: application/x.simple
      username: temp
      password: temp
      addTopicAsAttribute: topic
      simpleValueAttribute: vfloat
      simpleValueAttributeType: float
  - name: temp_simple_time
    type: mqtt
    destinations: 
      - $model.temperatur 
    config: 
      broker: 192.168.178.12:1883
      topic: stat/temperatur/simple/time
      payload: application/x.simple
      username: temp
      password: temp
      addTopicAsAttribute: topic
      simpleValueAttribute: vtime
      simpleValueAttributeType: time
  - name: temp_simple_bool
    type: mqtt
    destinations: 
      - $model.temperatur 
    config: 
      broker: 192.168.178.12:1883
      topic: stat/temperatur/simple/bool
      payload: application/x.simple
      username: temp
      password: temp
      addTopicAsAttribute: topic
      simpleValueAttribute: vbool
      simpleValueAttributeType: bool
rules:
  - name: tasmota_ds18b20
    description: transforming the tasmota json structure of the DS18B20 into my simple structure
    transform: 
      - operation: shift
        spec: 
          Temperature: DS18B20.Temperature
          TempUnit: TempUnit
          Datetime: Time
          Timestamp: Time
          Msg: $
      - operation: timestamp
        spec:
          Timestamp: {
            inputFormat: 2006-01-02T15:04:05,
            outputFormat: $unixext
          }
  - name: hm_temp_simple
    description: handle homematic temperatur rightly
    transform:
      - operation: shift
        spec: 
          Temperature: val
          Timestamp: ts
          Datetime: ts
      - operation: default
        spec: 
          TempUnit: C
      - operation: timestamp
        spec:
          Datetime: {
            inputFormat: $unixext,
            outputFormat: 2006-01-02T15:04:05-0700
          }
destinations:
  - name: mqtt_sensors_temperatur
    type: mqtt
    config: 
      broker: 192.168.178.12:1883
      topic: stat/temperatur
      payload: application/json
      username: temp
      password: temp
